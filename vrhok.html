<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>vrhok</title>

  <style>
    :root{
      --bg:#070812;
      --fg:#f5f6ff;
      --muted:rgba(245,246,255,.72);
      --line:rgba(255,255,255,.14);
    }

    html,body{min-height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--fg);
      background:
        radial-gradient(900px 520px at 18% 0%, rgba(124,92,255,.28), transparent 60%),
        radial-gradient(900px 520px at 82% 10%, rgba(0,200,255,.18), transparent 58%),
        radial-gradient(1200px 900px at 50% 120%, rgba(255,255,255,.06), transparent 70%),
        var(--bg);
      padding: 22px;
    }

    /* Force curseur visible ici (indépendant du style global) */
    html, body, * { cursor: auto !important; }

    .box{
      max-width: 720px;
      margin: 0 auto;
      border: 1px solid var(--line);
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      backdrop-filter: blur(12px);
      padding: 16px;
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
    }

    .rowTop{
      display:flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .title{
      margin:0;
      font-size: 16px;
      font-weight: 900;
      letter-spacing: -.02em;
    }

    .muted{
      color: var(--muted);
      font-size: 13px;
    }

    .big{
      font-size: 52px;
      font-weight: 900;
      letter-spacing: 6px;
      margin: 12px 0 8px;
      user-select: text;
      word-break: break-word;
    }

    button{
      height: 44px;
      padding: 0 14px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: var(--fg);
      font-weight: 900;
      cursor: pointer;
    }
    button:hover{ background: rgba(255,255,255,.10); }

    /* ===== Lock overlay (always on each visit) ===== */
    body.is-locked{
      overflow: hidden;
      touch-action: none;
    }

    .lockOverlay{
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 18px;
      background: rgba(7,8,18,.78);
      backdrop-filter: blur(12px);
      touch-action: manipulation;
    }

    .lockOverlay, .lockOverlay *{
      cursor: auto !important;
    }

    .lockCard{
      width: min(520px, 100%);
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      box-shadow: 0 18px 60px rgba(0,0,0,.60);
      padding: 16px;
    }

    .lockTitle{
      margin: 0;
      font-size: 16px;
      font-weight: 900;
      letter-spacing: -.02em;
    }

    .lockHint{
      margin: 10px 0 12px;
      color: rgba(245,246,255,.72);
      font-size: 13px;
      line-height: 1.35;
    }

    .lockRow{
      display:flex;
      gap: 10px;
    }

    .lockInput{
      flex: 1;
      height: 44px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: var(--fg);
      padding: 0 12px;
      font-weight: 800;
      outline: none;
      font-size: 16px; /* anti-zoom iOS */
      cursor: text !important;
    }

    .lockBtn{
      height: 44px;
      padding: 0 14px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: var(--fg);
      font-weight: 900;
      cursor: pointer !important;
    }

    .lockError{
      margin-top: 10px;
      font-size: 12px;
      color: rgba(255,140,140,.90);
      min-height: 16px;
    }
  </style>
</head>

<body class="is-locked">
  <div class="box" aria-hidden="true">
    <div class="rowTop">
      <h1 class="title">Code horaire</h1>
      <div id="info" class="muted"></div>
    </div>

    <div id="code" class="big">....</div>

    <div class="rowTop">
      <div class="muted">Valable pour l’heure UTC en cours.</div>
      <button id="copy" type="button">Copier</button>
    </div>
  </div>

  <div class="lockOverlay" id="lock">
    <div class="lockCard" role="dialog" aria-modal="true" aria-label="Accès privé">
      <h2 class="lockTitle">Accès privé</h2>
      <p class="lockHint">Entrez le mot de passe pour afficher le code horaire.</p>

      <div class="lockRow">
        <input id="pw" class="lockInput" type="password" autocomplete="off" placeholder="Mot de passe" aria-label="Mot de passe" />
        <button id="ok" class="lockBtn" type="button">OK</button>
      </div>

      <div id="err" class="lockError" aria-live="polite"></div>
    </div>
  </div>

  <script>
    const SECRET = "vrh"; // must match app.js
    const PAGE_PASSWORD = "wyrsev-poxbEc-7parze";

    function getHourlyCode() {
      const now = new Date();
      const y = now.getUTCFullYear();
      const m = now.getUTCMonth() + 1;
      const d = now.getUTCDate();
      const h = now.getUTCHours();

      const base = `${SECRET}${y}${m}${d}${h}`;

      let hash = 0;
      for (let i = 0; i < base.length; i++) {
        hash = (hash * 31 + base.charCodeAt(i)) >>> 0;
      }

      const chars = "abcdefghijklmnopqrstuvwxyz0123456789";
      let code = "";
      for (let i = 0; i < 4; i++) {
        code += chars[hash % chars.length];
        hash = Math.floor(hash / chars.length);
      }
      return code;
    }

    const lock = document.getElementById("lock");
    const card = lock.querySelector(".lockCard");
    const pw = document.getElementById("pw");
    const ok = document.getElementById("ok");
    const err = document.getElementById("err");

    const codeEl = document.getElementById("code");
    const infoEl = document.getElementById("info");
    const copyBtn = document.getElementById("copy");

    function render() {
      const now = new Date();
      const code = getHourlyCode();
      codeEl.textContent = code;
      infoEl.textContent = `UTC: ${now.toUTCString()} — Paris: ${now.toLocaleString("fr-FR")}`;
    }

    function unlockPage() {
      const v = String(pw.value || "");
      if (v === PAGE_PASSWORD) {
        document.body.classList.remove("is-locked");
        lock.style.display = "none";
        err.textContent = "";
        render();
        setInterval(render, 1000);
        return;
      }
      err.textContent = "Mot de passe incorrect.";
      pw.select();
      pw.focus();
    }

    ok.addEventListener("click", unlockPage);
    pw.addEventListener("keydown", (e) => {
      if (e.key === "Enter") unlockPage();
    });

    // Block scroll behind the overlay (but do NOT block taps on input)
    lock.addEventListener("wheel", (e) => e.preventDefault(), { passive: false });
    lock.addEventListener("touchmove", (e) => e.preventDefault(), { passive: false });

    // If user taps outside the card, refocus input (fix "can't reopen keyboard")
    lock.addEventListener("pointerdown", (e) => {
      if (!card.contains(e.target)) {
        e.preventDefault();
        setTimeout(() => pw.focus(), 0);
      }
    }, { passive: false });

    setTimeout(() => pw.focus(), 80);

    copyBtn.addEventListener("click", async () => {
      const code = getHourlyCode();
      await navigator.clipboard.writeText(code);
      copyBtn.textContent = "Copié ✅";
      setTimeout(() => (copyBtn.textContent = "Copier"), 900);
    });
  </script>
</body>
</html>
